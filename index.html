<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Navigator Pro</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f1f5f9; }
        .modal-animate { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- DATABASE CONFIG ---
        const SB_URL = 'https://bbgcsddwzcrxwzczrojf.supabase.co';
        const SB_KEY = 'sb_publishable_678Ol2HCLnEtOJNwly0vDg_XQS9f72f';
        const supabase = window.supabase.createClient(SB_URL, SB_KEY);

        function App() {
            const [systems, setSystems] = useState([]);
            const [activeSys, setActiveSys] = useState(null);
            const [notes, setNotes] = useState("");
            const [filter, setFilter] = useState('all'); // all | pending | cleared
            const [searchTerm, setSearchTerm] = useState('');
            const [loading, setLoading] = useState(false);

            useEffect(() => { loadData(); }, []);

            const loadData = async () => {
                const { data } = await supabase.from('systems').select('*').order('id');
                setSystems(data || []);
            };

            const filteredData = useMemo(() => {
                return systems.filter(item => {
                    const matchesSearch = item.id.toLowerCase().includes(searchTerm.toLowerCase());
                    const isDone = item.notes || item.has_attachment;
                    if (filter === 'pending') return matchesSearch && !isDone;
                    if (filter === 'cleared') return matchesSearch && isDone;
                    return matchesSearch;
                });
            }, [systems, filter, searchTerm]);

            const handleSave = async () => {
                setLoading(true);
                const file = document.getElementById('file-upload')?.files[0];
                let hasAttach = activeSys.has_attachment;

                if (file) {
                    await supabase.storage.from('photos').upload(`${activeSys.id}.jpg`, file, { upsert: true });
                    hasAttach = true;
                }

                await supabase.from('systems').update({ notes, has_attachment: hasAttach }).eq('id', activeSys.id);
                setLoading(false);
                setActiveSys(null);
                loadData();
            };

            return (
                <div className="min-h-screen pb-20">
                    {/* STICKY HEADER */}
                    <nav className="bg-white/80 backdrop-blur-md border-b sticky top-0 z-20 px-6 py-4">
                        <div className="max-w-6xl mx-auto flex flex-col md:flex-row gap-4 justify-between items-center">
                            <div className="flex items-center gap-2">
                                <div className="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-200">
                                    <span className="text-white font-extrabold text-xl">Q</span>
                                </div>
                                <h1 className="text-xl font-extrabold text-slate-800 tracking-tight">NAVIGATOR</h1>
                            </div>

                            <div className="flex items-center gap-3 w-full md:w-auto">
                                <input 
                                    type="text" 
                                    placeholder="Search System ID..." 
                                    className="flex-1 md:w-64 px-4 py-2 bg-slate-100 rounded-xl outline-none border-2 border-transparent focus:border-indigo-500 transition-all text-sm"
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                />
                                <button 
                                    onClick={() => {
                                        const id = prompt("New System ID:");
                                        if(id) supabase.from('systems').insert([{id}]).then(loadData);
                                    }}
                                    className="bg-indigo-600 hover:bg-indigo-700 text-white px-5 py-2 rounded-xl text-sm font-bold transition-all whitespace-nowrap"
                                >
                                    + Add Unit
                                </button>
                            </div>
                        </div>
                    </nav>

                    {/* FILTER TABS */}
                    <div className="max-w-6xl mx-auto px-6 mt-8">
                        <div className="flex p-1 bg-slate-200 rounded-2xl w-fit">
                            {['all', 'pending', 'cleared'].map(t => (
                                <button 
                                    key={t}
                                    onClick={() => setFilter(t)}
                                    className={`px-6 py-2 rounded-xl text-xs font-bold uppercase tracking-widest transition-all ${filter === t ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}
                                >
                                    {t
